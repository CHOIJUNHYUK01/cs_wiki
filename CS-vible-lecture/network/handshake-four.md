# 4-웨이 핸드셰이크

TCP의 연결해제과정은 4개의 과정으로 이뤄진다.

1. FIN : 클라이언트가 연결을 닫으려고 할 때, `FIN`으로 설정된 세그먼트를 보낸다. 클라이언트는 `FIN_WAIT_1`상태로 들어가 서버 응답을 기다린다.
2. ACK : 서버는 클라이언트로 `ACK`라는 승인 세그먼트를 보내고 `CLOSE_WAIT`상태에 빠진다. 클라이언트가 세그먼트를 받으면 `FIN_WAIT_2`상태에 들어간다.
3. FIN : 서버는 `LAST_ACK`상태가 되며, 일정 시간 이후에 클라이언트에 `FIN`이라는 세그먼트를 보낸다.
4. ACK : 클라이언트는 `TIME_WAIT`상태가 되고, 다시 서버로 `ACK`를 보내서 서버는 `CLOSED`상태가 된다. 이후 클라이언트는 어느 정도의 시간(TIME_WAIT으로 설정된 시간)을 대기한 후 연결이 닫힌다.

### 해제할 때 TIME_WAIT은 뭔가

> 지연 패킷 등이 발생했을 때, 데이터 무결성을 해결하기 위해 패킷을 기다리는 시간을 말한다.

2 \* MSL 동안 기다린다.
MSL : maximum segment lifetime으로, 최대 패킷 수명이라고 한다.

그리고 이는 OS마다 다르다.
