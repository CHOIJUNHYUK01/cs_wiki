# HTTP/1.0 과 HTTP/1.1의 차이

HTTP 요청 기술은 1.0부터 시작해 지금은 3까지 많은 발전을 거듭해왔다.

### HTTP/1.0

수명이 짧은 연결이다.
HTTP 요청은 자체 요청에서 완료가 된다.
각 HTTP 요청당 TCP 핸드셰이크가 발생되며, 한 열결당 하나의 요청을 처리하도록 설계되어있다.
한 번 연결할 때마다 TCP 연결을 계속해야 하니, RTT가 늘어나는 문제점이 있다.

### HTTP/1.1

RTT가 늘어나는 HTTP/1.0의 단점을 보완한 프로토콜이다.

아래는 그 차이 3가지다.

1. keep-alive default

> 매번 데이터를 요청할 때마다 TCP 연결을 하는게 아닌, 한 번 해놓고 계속해서 데이터를 받을 수 있게 만든다. 이는 keep-alive 옵션을 기본 옵션으로 하면서 가능해졌다.

```javascript
const express = require("express");
const app = express();
app.get("/", (req, res) => {
  res.json({ a: 1 });
});
const server = app.listen(12010);
server.keepAliveTimeout = 30 * 1000;
```

`keep-alive header`

TCP 연결을 유지하는 것을 알려주는 헤더로, 연결 유지 시간인 timeout과 최대 요청수 max를 정할 수 있다.
node.js에서는 연결유지시간인 timeout 시간만 지정이 가능하다.

2. 호스트 헤더

HTTP/1.0은 서버가 하나의 호스트만 가진다고 가정했기 때문에, 헤더에 호스트를 포함하지 않았다.
이 때문에 하나의 IP에 하나의 호스트만 가질 수 있었다.

그러나 사실 서버는 여러 개의 호스트를 가질 수 있고, 이런 유연성을 위해 HTTP/1.1은 헤더에 특정 호스트를 포함할 수 있게 변경됐다.
그래서 항상 호스트를 포함해서 요청하도록 바꼈다.

3. 대역폭 최적화

HTTP/1.0은 어떤 파일을 다운로드 받다가 연결이 끊기면, 다시 다운로드 받는 것이 불가능하다.

HTTP/1.1은 이를 다시 다운로드 받을 수 있게 바꿨다.
`Range:bytes=5000-`라는 헤더를 추가해서 다운로드 재개 요청을 할 수 있게 했다.

### 요청을 줄이기 위한 기술

발전했음에도 불구하고 서버 요청을 할 때마다 RTT는 계속 증가하기 때문에 요청을 줄이기 위한 여러가지 기술이 생겼다.
대표적으로 아래 3가지다.

1. 이미지 스프라이트

수많은 이미지를 하나의 이미지로 만들어 하나의 이미지만 다운받아놓고 이를 통해 수많은 이미지를 다운받는 듯한 효과를 내는 것이다.

2. 코드압축

코드를 압축해 서빙한다.

3. 이미지 Base64 인코딩

이미지 파일을 64진법으로 이뤄진 문자열로 인코딩해서 이미지 서버에 대한 HTTP 요청을 할 필요가 없이 만드는 것이다.
하지만 Base64 인코딩을 하면, 파일 크기가 37퍼센트 정도 크기가 커지는 단점이 있다.

### HTTP/1.1의 고질적인 문제 : HOL (Head Of Line Blocking)

HOL과 무거운 헤더를 갖는 문제점이 있으며, 이를 해결하지 못했다.

\*HOL이란?
네트워크에서 같은 큐에 있는 패킷이 그 첫 번째 패킷에 의해 지연될 때 발생하는 성능저하현상이다.
