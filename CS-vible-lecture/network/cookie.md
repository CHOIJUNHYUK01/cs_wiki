# 쿠키

> 브라우저에 저장된 데이터 조각이다. 클라이언트나 서버에서 설정할 수 있다. 보통 서버에서 먼저 설정하고 쿠키를 만드는 게 일반적이다.

서버에서 응답헤더로 `Set-Cookie`로 설정해 쿠키를 보내면, 그때부터 클라이언트에서 요청헤더 `Cookie`에 설정되어 자동으로 서버에 전달된다.
이후에 브라우저에 자동 저장된다.

### 왜 서버에서 쿠키를 설정하고 보내는가

서버에서 만료 기한 등을 설정 및 컨트롤을 한다.
저장 용량은 최대 4kb까지 가능하다.

보통 로그인, 장바구니, 사용자 커스터마이징, 사용자 행동분석(주로 개인화된 광고에 활용된다)에 사용된다.

개인정보에 해당하는 만큼 클라이언트에서 설정한다면, 클라이언트에서 자바스크립트로 `document.cookie`를 통해 설정할 수 있게 된다.
이렇게 되면 쿠키 제어권을 클라이언트에 두게 된다.
그렇게 되면 탈취당할 위험이 있기에 서버가 담당한다.

### 세션 쿠키

Expires 또는 Max-Age 속성을 지정하지 않은 것이다.
브라우저가 종료되면 쿠키도 사라진다.

### 영구 쿠키

Expires 또는 Max-Age 솔성을 지정해, 특정 날짜 또는 일정 기간이 지나면 삭제되게 만든 쿠키다.
브라우저를 닫아도 만료되지 않는다.

### 다른 속성

1. secure

> https로만 쿠키를 주고받을 수 있게 하는 옵션이다.

그러나 일부 브라우저는 보안을 강화하고, 안전하지 않은 사이트(HTTP)가 Secure 지시문으로 쿠키를 설정하는 걸 금지하기 위해 이 사양을 현재는 무시한다.

2. httponly

공격자가 자바스크립트로 빼낼 수 없게 만든다.

3. samesite

요청이 동일한 도메인에서 시작된 경우에만 쿠키가 애플리케이션으로 전송되도록 허용한다.

### 쿠키의 시큐어 코딩

쿠키 - 세션으로 로그인을 처리한다면 다음과 같은 시큐어 코딩을 해야 한다.

1. cookie에 세션ID를 담을 때, 이 세션ID를 기반으로 클라이언트의 개인정보를 유추할 수 없게 해야 한다.
2. 자바스크립트로는 파악할 수 없게 httponly 옵션을 걸어야 한다.
3. 일정 시간의 세션 타임아웃을 걸어야 한다.

### 쿠키 허용 관련 알림창

서비스 운용시 쿠키를 사용한다면, 이를 만들어야 한다.
방문 기록을 추적할 때, 쿠키가 사용되기 때문이다.
이는 사용자의 데이터 간접수집에 해당하며, 거기에 해당하는 KISA 지침을 준수해야 하기 때문이다.
