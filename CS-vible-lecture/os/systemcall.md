# 시스템콜과 modebit

### 시스템콜

> 운영체제가 커널에 접근하기 위한 인터페이스다. 유저 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출할 때, 이를 거쳐 호출하도록 설계됐다.

프로세스 관리(생성, 삭제 등), 파일관리, 디바이스 관리, 시간 및 날짜 관련 시스템, 프로세스간 통신 때 이를 통해 커널함수를 호출한다.
예를 들어 프로세스를 종료하는 kill()이라는 함수가 있다. 이 함수를 발동시키면 시스템콜을 거쳐 커널함수가 호출된다.

#### 시스템 콜의 과정

만약 유저 프로그램이 I/O 요청을 위한 트랩을 발동했다고 하면, 아래 과정이 발생된다.

1. 유저 프로그램이 I/O 요청해 트랩이 발동한다.
2. 올바른 I/O 요청인지 확인한다.
3. 유저 모드가 시스템콜을 통해 커널모드로 변환한다.
4. 이후 커널함수를 실행한다.

#### 커널함수

커널안에 있는 여러 개의 함수다. (native function이라고도 한다.)

#### 커널

운영체제의 핵심 부분이자 시스템콜을 제공해 보안, 메모리, 프로세스, 파일 시스템, I/O 디바이스, I/O 요청 관리 등 운영체제의 중추적인 역할을 한다.

#### 유저모드

유저가 접근할 수 있는 영역을 제한적으로 두며, 컴퓨터 자원에 함부로 침범하지 못하는 모드다.

#### 커널모드

모든 컴퓨터 자원에 접근할 수 있는 모드다.

#### modebit

시스템콜이 작동될 때, modebit을 기반으로 유저 모드와 커널 모드를 구분한다.
modebit은 1 또는 0의 값을 가지는 플래스 변수다.
1은 유저모드, 0은 커널모드다.

#### 시스템콜의 장점

> 유저 프로그램은 시스템콜을 기반으로 커널과 분리가 된다. 유저프로그램은 복잡한 파일 시스템과 프로세스 생성 등에 대한 내부 동작을 신경쓸 필요가 없다. 운영체제의 관리하에 프로그램이 운영되므로 시스템의 안정성과 보안이 강화된다.

공격자가 만든 카메라 앱 프로그램이 아무런 제약없이 커널에 접근할 수 있다면, 사생활이 노출되는 상황이 발생될 수 있다.
이를 방지하기 위해 유저 모드에서 시스템콜로만 커널 모드에 집입할 수 있는 단 하나의 통로를 만든 것이다.

### 메모리 계층

> 레지스터, 캐시, 주기억장치, 보조기억장치로 구성된다.

1. 레지스터 : CPU 내의 작은 메모리, 휘발성, 속도가 가장 빠르다. 기억 용량이 가장 적음.
2. 캐시 : CPU 내의 L1, L2 캐시를 지칭한다. 휘발성, 속도가 빠르다. 기억 용량이 적다.
3. 주기억장치 : RAM을 가리킨다. 휘발성, 속도 보통, 기억 용량이 보통이다.
4. 보조기억장치 : HDD, SSD를 말한다. 비휘발성, 속도 낮고, 기억 용량이 많다.

#### 계층이 존재하는 이유

1. 더 빠른 접근과 처리속도가 증가한다.

우리는 보통 많이 쓰는 걸 다시 많이 쓴다.
이 때문에 특정 데이터에 많이 접근하게 되는데, 좀 더 작은 캐시 메모리에 해당 데이터가 있다면 더 빠르게 해당 데이터에 접근이 가능하다.
그로 인해, 처리속도도 증가하게 된다.

2. 비용의 효율성

캐시메모리는 비싸고, 램 등 아래로 갈수록 비용은 더 저렴하다.
계층이 있고 캐싱 때문에 비용을 좀 더 효율적으로 쓸 수 있다.

3. 자원의 효율적 사용

메모리 계층 구조는 자주 접근하는 데이터는 빠른 메모리에, 덜 접근하는 데이터는 느린 메모리에 저장해 자원을 효율적으로 사용할 수 있다.
이렇게 하면 거의 접근하지 않은 데이터에 비싸고 빠른 메모리를 사용하지 않게 되어 자원을 낭비하지 않게 된다.

우리가 흔히 보는 로딩중이라는 것은 사실 내부에서 하드디스크 또는 인터넷에서 데이터를 읽어, RAM으로 전송하는 과정이 아직 끝나지 않음을 의미한다.
